<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NurseCare+ Diagnostic Assistant (Ncare)</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            /* Canva-Inspired Background: Dark, professional theme */
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
            min-height: 100vh;
        }
        /* Custom styles for the nursing theme */
        .primary-color { background-color: #2c77d0; } /* Deep Blue */
        .secondary-color { background-color: #6ed02c; } /* Vibrant Green */
        .text-primary-color { color: #2c77d0; }
        .text-secondary-color { color: #6ed02c; }
        
        /* Utility for consistent card styling */
        .app-card {
            background-color: #ffffff;
            border-radius: 1rem; /* More rounded corners */
            box-shadow: 0 15px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.04); /* Stronger, professional shadow */
            transition: transform 0.2s;
        }

        /* Animation for loading state */
        .loader {
            border-top-color: #ffffff;
            border-left-color: #ffffff;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Hero container for contrast on dark background */
        .hero-container {
            background-color: #f3f4f6; /* Light gray for contrast */
            border-radius: 1rem;
        }
        
    </style>
    <!-- Lucide Icons for better UI -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="flex flex-col">

    <!-- Navbar -->
    <header class="primary-color shadow-lg sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo/App Name -->
                <div class="flex-shrink-0">
                    <span class="text-white text-3xl font-extrabold tracking-wider">Ncare<span class="text-secondary-color">+</span></span>
                </div>
                <!-- Desktop Menu -->
                <nav class="hidden md:flex space-x-2">
                    <button onclick="showPage('home')" class="nav-btn text-white hover:bg-white hover:bg-opacity-20 px-3 py-2 rounded-lg text-sm font-medium transition duration-150 flex items-center">
                        <i data-lucide="home" class="w-4 h-4 mr-1"></i> Home
                    </button>
                    <button onclick="showPage('about')" class="nav-btn text-white hover:bg-white hover:bg-opacity-20 px-3 py-2 rounded-lg text-sm font-medium transition duration-150 flex items-center">
                        <i data-lucide="info" class="w-4 h-4 mr-1"></i> About
                    </button>
                    <button onclick="showPage('assessment')" class="nav-btn text-white hover:bg-white hover:bg-opacity-20 px-3 py-2 rounded-lg text-sm font-medium transition duration-150 flex items-center">
                        <i data-lucide="clipboard-list" class="w-4 h-4 mr-1"></i> Assessment
                    </button>
                    <button onclick="showPage('diagnosis')" class="nav-btn text-white font-extrabold px-3 py-2 rounded-lg text-sm transition duration-150 bg-white bg-opacity-30 flex items-center">
                        <i data-lucide="stethoscope" class="w-4 h-4 mr-1"></i> Diagnosis
                    </button>
                    <button onclick="showPage('contact')" class="nav-btn text-white hover:bg-white hover:bg-opacity-20 px-3 py-2 rounded-lg text-sm font-medium transition duration-150 flex items-center">
                        <i data-lucide="mail" class="w-4 h-4 mr-1"></i> Contact
                    </button>
                </nav>
                <!-- Mobile Menu Button -->
                <button id="mobile-menu-btn" class="md:hidden text-white focus:outline-none">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
            </div>
        </div>
        <!-- Mobile Menu (Hidden by default) -->
        <div id="mobile-menu" class="hidden md:hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <button onclick="showPage('home'); toggleMobileMenu()" class="text-white block px-3 py-2 rounded-md text-base font-medium w-full text-left hover:bg-white hover:bg-opacity-20 flex items-center"><i data-lucide="home" class="w-5 h-5 mr-2"></i> Home</button>
                <button onclick="showPage('about'); toggleMobileMenu()" class="text-white block px-3 py-2 rounded-md text-base font-medium w-full text-left hover:bg-white hover:bg-opacity-20 flex items-center"><i data-lucide="info" class="w-5 h-5 mr-2"></i> About</button>
                <button onclick="showPage('assessment'); toggleMobileMenu()" class="text-white block px-3 py-2 rounded-md text-base font-medium w-full text-left hover:bg-white hover:bg-opacity-20 flex items-center"><i data-lucide="clipboard-list" class="w-5 h-5 mr-2"></i> Assessment</button>
                <button onclick="showPage('diagnosis'); toggleMobileMenu()" class="text-white block px-3 py-2 rounded-md text-base font-medium w-full text-left bg-white bg-opacity-20 flex items-center"><i data-lucide="stethoscope" class="w-5 h-5 mr-2"></i> Diagnosis</button>
                <button onclick="showPage('contact'); toggleMobileMenu()" class="text-white block px-3 py-2 rounded-md text-base font-medium w-full text-left hover:bg-white hover:bg-opacity-20 flex items-center"><i data-lucide="mail" class="w-5 h-5 mr-2"></i> Contact</button>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow w-full">

        <!-- Page: Home (Hero Section) -->
        <div id="page-home" class="page-content py-16 md:py-24 hidden">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <div class="hero-container p-8 md:p-12 app-card">
                    <div class="mb-4">
                        <i data-lucide="heart-pulse" class="w-16 h-16 text-primary-color mx-auto stroke-[1.5]"></i>
                    </div>
                    <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-900 mb-4 tracking-tight">
                        Your Clinical Decision Partner: <span class="text-primary-color">NurseCare+</span>
                    </h1>
                    <p class="text-lg sm:text-xl text-gray-700 max-w-3xl mx-auto mb-8">
                        Bridging patient assessment data to actionable, evidence-based nursing care plans and diagnoses, quickly and simply.
                    </p>
                    
                    <button onclick="showPage('diagnosis')" class="secondary-color text-white font-bold py-3 px-8 text-lg rounded-full hover:bg-opacity-90 transition duration-300 shadow-xl transform hover:scale-105">
                        Start Diagnosis Now <i data-lucide="arrow-right" class="inline-block w-5 h-5 ml-2"></i>
                    </button>
                </div>

                <div class="mt-16 grid md:grid-cols-3 gap-6 text-left">
                    <div class="app-card p-6 border-t-4 border-primary-color">
                        <i data-lucide="trending-up" class="w-8 h-8 text-primary-color mb-3"></i>
                        <h3 class="font-bold text-xl mb-2 text-gray-800">Streamlined Workflow</h3>
                        <p class="text-gray-600">Enter data using the familiar S.O.A.P. format for rapid analysis.</p>
                    </div>
                    <div class="app-card p-6 border-t-4 border-secondary-color">
                        <i data-lucide="clipboard-check" class="w-8 h-8 text-secondary-color mb-3"></i>
                        <h3 class="font-bold text-xl mb-2 text-gray-800">Grounded Interventions</h3>
                        <p class="text-gray-600">All results are validated with citations from leading clinical guidelines.</p>
                    </div>
                    <div class="app-card p-6 border-t-4 border-primary-color">
                        <i data-lucide="graduation-cap" class="w-8 h-8 text-primary-color mb-3"></i>
                        <h3 class="font-bold text-xl mb-2 text-gray-800">Educational Support</h3>
                        <p class="text-gray-600">An excellent learning tool for students to master the nursing process.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page: About -->
        <div id="page-about" class="page-content py-16 hidden">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="app-card p-8 md:p-12">
                    <h1 class="text-4xl font-extrabold text-primary-color mb-6 flex items-center">
                        <i data-lucide="info" class="w-8 h-8 mr-3 stroke-[2]"></i> About Ncare+
                    </h1>
                    <p class="text-gray-700 leading-relaxed text-lg">
                        NurseCare+ (Ncare) was created to streamline the often complex process of clinical judgment and care planning. We understand that for busy nursing students and practitioners, **clarity and speed are crucial**. 
                        <br><br>
                        Our engine uses advanced AI, continually updated and grounded with real-time web searches, to provide preliminary nursing diagnoses and intervention suggestions. This guidance is built upon recognized standards from organizations like **NANDA**, the **WHO**, and local DOH guidelines.
                        <br><br>
                        <strong class="text-red-500">Disclaimer:</strong> Ncare+ is a powerful learning and decision-support tool, but it must always complement, not replace, your professional clinical judgment. Always verify findings with your clinical instructor or senior nurse.
                    </p>
                </div>
            </div>
        </div>

        <!-- Page: Health Assessment -->
        <div id="page-assessment" class="page-content py-16 hidden">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="app-card p-8 md:p-12">
                    <h1 class="text-4xl font-extrabold text-primary-color mb-8 flex items-center">
                        <i data-lucide="clipboard-list" class="w-8 h-8 mr-3 stroke-[2]"></i> Health Assessment Guide
                    </h1>
                    <p class="text-gray-700 mb-8 text-lg">A solid assessment is the foundation of quality nursing care. Use this guide to ensure you collect all the essential data points before generating a diagnosis:</p>
                    <div class="space-y-6">
                        <div class="p-6 bg-blue-50 rounded-lg border-l-4 border-primary-color">
                            <h3 class="font-bold text-xl text-primary-color flex items-center mb-2">
                                <i data-lucide="user-square" class="w-6 h-6 mr-2"></i> Subjective Data (S: The Client's Story)
                            </h3>
                            <ul class="list-disc list-inside ml-4 text-gray-700 text-base space-y-1">
                                <li>**Chief Complaint:** The primary reason for seeking care.</li>
                                <li>**History of Present Illness:** Detailed description of the symptoms using **PQRST** or **COLDSPA**.</li>
                                <li>**Past History:** Relevant medical conditions, surgeries, and family history.</li>
                            </ul>
                        </div>
                        <div class="p-6 bg-green-50 rounded-lg border-l-4 border-secondary-color">
                            <h3 class="font-bold text-xl text-secondary-color flex items-center mb-2">
                                <i data-lucide="activity" class="w-6 h-6 mr-2"></i> Objective Data (O: The Findings)
                            </h3>
                            <ul class="list-disc list-inside ml-4 text-gray-700 text-base space-y-1">
                                <li>**Vital Signs:** Precise measurements of BP, HR, RR, Temp, and O2 Saturation.</li>
                                <li>**Physical Exam:** Observation (e.g., skin color), Palpation (e.g., pulse quality), Auscultation (e.g., lung sounds).</li>
                                <li>**Diagnostic Data:** Key lab results (e.g., Hemoglobin) and imaging findings.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page: Contact -->
        <div id="page-contact" class="page-content py-16 hidden">
            <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="app-card p-8 md:p-12 text-center">
                    <h1 class="text-4xl font-extrabold text-primary-color mb-8 flex items-center justify-center">
                        <i data-lucide="send" class="w-8 h-8 mr-3 stroke-[2]"></i> Contact & Feedback
                    </h1>
                    <p class="text-gray-700 mb-6 text-lg">We welcome your suggestions and feedback to continuously improve NurseCare+ for the nursing community.</p>
                    
                    <div class="mt-8 space-y-4">
                        <div class="text-gray-900">
                            <p class="font-bold text-xl text-primary-color">Sarip, Abdulmalik G.</p>
                            <p class="text-gray-600">BS Nursing, 20241062</p>
                            <p class="text-gray-600">PEACI College of Nursing</p>
                        </div>
                        
                        <div class="pt-6 border-t border-gray-100 space-y-3">
                            <p class="text-lg font-medium text-gray-800 flex items-center justify-center">
                                <i data-lucide="mail" class="w-5 h-5 mr-2 text-secondary-color"></i> 
                                Email: <a href="mailto:abdulmaliksarip566@gmail.com" class="text-primary-color hover:underline ml-2">abdulmaliksarip566@gmail.com</a>
                            </p>
                            <p class="text-lg font-medium text-gray-800 flex items-center justify-center">
                                <i data-lucide="phone" class="w-5 h-5 mr-2 text-secondary-color"></i> 
                                Mobile: <a href="tel:+639810420232" class="text-primary-color hover:underline ml-2">09810420232</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Page: Diagnosis (The main interactive page) -->
        <div id="page-diagnosis" class="page-content py-16 block">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h1 class="text-4xl font-extrabold text-white mb-10 flex items-center justify-center">
                    <i data-lucide="stethoscope" class="w-9 h-9 mr-3 text-secondary-color stroke-[2]"></i> Client Diagnosis Tool
                </h1>
                
                <div class="grid lg:grid-cols-2 gap-8">
                    <!-- Input Form -->
                    <div class="app-card p-8 border-t-8 border-secondary-color">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center">1. Enter Client Data (S.O.A.P.)</h2>
                        
                        <label for="vitals" class="block text-sm font-medium text-gray-700 mt-4 mb-1">Vital Signs (O: Objective Data - The Basics):</label>
                        <textarea id="vitals" rows="2" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary-color focus:border-primary-color transition duration-150" placeholder="Example: BP 140/90, HR 105, RR 24, Temp 38.5Â°C, O2Sat 90%"></textarea>
                        
                        <label for="subjective" class="block text-sm font-medium text-gray-700 mt-4 mb-1">Subjective Data (S: The Client's Words):</label>
                        <textarea id="subjective" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary-color focus:border-primary-color transition duration-150" placeholder="Example: 'I feel short of breath and tired.'"></textarea>

                        <label for="objective" class="block text-sm font-medium text-gray-700 mt-4 mb-1">Objective Data (O: Your Exam Findings - The Details):</label>
                        <textarea id="objective" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary-color focus:border-primary-color transition duration-150" placeholder="Example: Crackles in both lung bases, pale, using accessory muscles to breathe."></textarea>

                        <button id="diagnose-btn" onclick="generateDiagnosis()" class="w-full secondary-color text-white font-bold py-4 px-4 mt-8 rounded-xl hover:bg-opacity-90 transition duration-150 shadow-lg flex items-center justify-center">
                            <span id="button-text">Generate Diagnosis & Care Plan</span>
                            <div id="loader" class="loader w-6 h-6 border-4 border-gray-200 border-b-secondary-color rounded-full ml-3 hidden"></div>
                        </button>

                        <p id="error-message" class="text-sm text-red-600 mt-3 hidden text-center font-medium"></p>
                    </div>

                    <!-- Results Output -->
                    <div class="app-card p-8 border-t-8 border-primary-color">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center">2. Nursing Care Generated</h2>
                        <div id="results-output" class="min-h-[250px] space-y-4">
                            <div class="p-4 bg-gray-50 rounded-lg text-center">
                                <i data-lucide="zap" class="w-8 h-8 mx-auto text-secondary-color mb-2"></i>
                                <p class="text-gray-500 italic font-medium">Enter patient data on the left and click 'Generate' to see a preliminary diagnosis and suggested care plan here.</p>
                            </div>
                        </div>

                        <!-- Citations Section -->
                        <div id="citations-area" class="mt-8 pt-4 border-t border-gray-100 hidden">
                            <h3 class="font-bold text-sm text-primary-color mb-3 flex items-center">
                                <i data-lucide="book-open" class="w-4 h-4 mr-2"></i> Sources (Grounded Information):
                            </h3>
                            <ul id="citations-list" class="text-xs text-gray-600 list-disc list-inside space-y-1">
                                <!-- Citations will be added here -->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white p-6 mt-12">
        <div class="max-w-7xl mx-auto text-center text-sm">
            &copy; 2024 NurseCare+ (Ncare). Decision Support Tool. Always verify findings with your instructor and institution policies.
        </div>
    </footer>

    <script type="module">
        // --- Setup for Lucide Icons ---
        // Ensures icons and JavaScript functions initialize after the page loads.
        window.onload = function() {
            lucide.createIcons();
            // Start on the diagnosis page by default
            showPage('diagnosis'); 
        }

        // Gemini API Configuration (Leave as empty string; Canvas will provide key at runtime)
        const apiKey = "";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // Utility functions
        function getElement(id) { return document.getElementById(id); }

        // --- View Management ---
        const pageContents = document.querySelectorAll('.page-content');
        const navButtons = document.querySelectorAll('.nav-btn');

        function showPage(pageId) {
            // Hide all pages
            pageContents.forEach(page => page.classList.add('hidden'));
            // Show the requested page
            getElement(`page-${pageId}`).classList.remove('hidden');

            // Update active state for nav buttons
            navButtons.forEach(btn => {
                // Check if the button's onclick attribute refers to the current pageId
                if (btn.onclick && btn.onclick.toString().includes(`showPage('${pageId}')`)) {
                    btn.classList.remove('hover:bg-white', 'hover:bg-opacity-20');
                    btn.classList.add('bg-white', 'bg-opacity-30', 'font-extrabold');
                } else {
                    btn.classList.add('hover:bg-white', 'hover:bg-opacity-20');
                    btn.classList.remove('bg-white', 'bg-opacity-30', 'font-extrabold');
                }
            });
        }

        const mobileMenuBtn = getElement('mobile-menu-btn');
        const mobileMenu = getElement('mobile-menu');

        function toggleMobileMenu() {
            mobileMenu.classList.toggle('hidden');
        }
        if (mobileMenuBtn) {
             mobileMenuBtn.addEventListener('click', toggleMobileMenu);
        }

        // --- Exponential Backoff for API Retries ---
        async function fetchWithBackoff(url, options, retries = 3, delay = 1000) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status === 429 && i < retries - 1) { // Too many requests
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2; // Exponential increase
                        continue;
                    }
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response;
                } catch (error) {
                    if (i === retries - 1) throw error;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
        }


        // --- Core Diagnosis Functionality ---

        async function generateDiagnosis() {
            const vitals = getElement('vitals').value.trim();
            const subjective = getElement('subjective').value.trim();
            const objective = getElement('objective').value.trim();
            const resultsOutput = getElement('results-output');
            const citationsArea = getElement('citations-area');
            const errorMessage = getElement('error-message');
            const loader = getElement('loader');
            const buttonText = getElement('button-text');

            if (!vitals && !subjective && !objective) {
                errorMessage.textContent = 'Please enter at least one piece of client data (Vitals, Subjective, or Objective).';
                errorMessage.classList.remove('hidden');
                return;
            }
            errorMessage.classList.add('hidden');
            
            // Set Loading State
            resultsOutput.innerHTML = `<div class="text-center mt-12"><div class="loader w-10 h-10 border-4 border-gray-200 border-b-secondary-color rounded-full mx-auto mb-3"></div><p class="text-primary-color font-semibold">Analyzing data and searching for clinical guidelines...</p></div>`;
            citationsArea.classList.add('hidden');
            loader.classList.remove('hidden');
            buttonText.textContent = 'Analyzing...';
            getElement('diagnose-btn').disabled = true;


            const userQuery = `
                Client Data:
                - VITAL SIGNS: ${vitals}
                - SUBJECTIVE DATA: ${subjective}
                - OBJECTIVE DATA: ${objective}

                Based on this data, provide a clear, simple, and non-jargonized response in three sections:
                1. Preliminary Nursing Diagnosis (e.g., Ineffective Airway Clearance related to...):
                2. Key Nursing Interventions (What to do, step-by-step):
                3. Monitoring Schedule (Suggested frequency for Vitals and Meds):
            `;

            // System prompt emphasizes using real-time, authoritative medical sources and keeping the language simple.
            const systemPrompt = "You are an experienced, empathetic, and professional Nursing Diagnostic Assistant. You adhere to the principles of evidence-based practice and use official medical sources (like NANDA, WHO, DOH, and recent clinical studies) to ground your advice. Your response must be extremely simple, short, and avoid medical jargon. Focus on practical, safe steps. If data is limited, state that the diagnosis is only preliminary.";

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                // Crucially, use Google Search for grounding (references)
                tools: [{ "google_search": {} }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            try {
                const response = await fetchWithBackoff(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const text = candidate.content.parts[0].text;
                    resultsOutput.innerHTML = formatGeneratedText(text);
                    
                    // Extract and display citations (the references)
                    displayCitations(candidate);
                } else {
                    const errorDetails = result.error?.message || 'Unknown API error.';
                    throw new Error(`Could not generate a response. Details: ${errorDetails}`);
                }
            } catch (error) {
                console.error("API call failed:", error);
                errorMessage.textContent = `An error occurred: ${error.message}. Please check your input and try again.`;
                resultsOutput.innerHTML = `<p class="text-center text-red-500 mt-12">Diagnosis failed. Check error message above.</p>`;
                errorMessage.classList.remove('hidden');
            } finally {
                // Reset Loading State
                loader.classList.add('hidden');
                buttonText.textContent = 'Generate Diagnosis & Care Plan';
                getElement('diagnose-btn').disabled = false;
            }
        }

        // --- Formatting and Citation Display ---
        function formatGeneratedText(text) {
            // Replace bold Markdown headers with styled HTML headers for better display
            return text.replace(/(\*\*\d+\. [^\*]+\*\*)/g, '<h3 class="font-bold text-xl mt-4 text-primary-color border-b pb-1 border-gray-100">$1</h3>')
                       .replace(/\*\*/g, '') // Remove remaining markdown bold
                       .replace(/\n/g, '<br>'); // Convert newlines to breaks
        }

        function displayCitations(candidate) {
            let sources = [];
            const groundingMetadata = candidate.groundingMetadata;

            if (groundingMetadata && groundingMetadata.groundingAttributions) {
                sources = groundingMetadata.groundingAttributions
                    .map(attribution => ({
                        uri: attribution.web?.uri,
                        title: attribution.web?.title,
                    }))
                    .filter(source => source.uri && source.title);
            }

            const citationsList = getElement('citations-list');
            citationsList.innerHTML = ''; 

            if (sources.length > 0) {
                sources.forEach((source, index) => {
                    const listItem = document.createElement('li');
                    listItem.className = 'hover:text-primary-color transition duration-150';
                    listItem.innerHTML = `<a href="${source.uri}" target="_blank" class="underline">${source.title}</a>`;
                    citationsList.appendChild(listItem);
                });
                getElement('citations-area').classList.remove('hidden');
            } else {
                const listItem = document.createElement('li');
                listItem.textContent = 'No specific sources were cited, but the response is based on general clinical knowledge.';
                citationsList.appendChild(listItem);
                getElement('citations-area').classList.remove('hidden');
            }
        }
    </script>
</body>
</html>
